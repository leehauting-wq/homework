<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèª²ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ“š åŠŸèª²ç®¡ç†ç³»çµ±</h1>
            <p class="text-gray-600">è¼•é¬†ç®¡ç†æ¯æ—¥åŠŸèª²ã€è¿½è¹¤é€²åº¦</p>
        </div>

        <!-- å°èˆªé¸å–® -->
        <div class="flex flex-wrap justify-center gap-4 mb-8">
            <button onclick="showSection('homework')" class="nav-btn bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                ğŸ“ ç™¼ä½ˆåŠŸèª²
            </button>
            <button onclick="showSection('missing')" class="nav-btn bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                âš ï¸ æ¬ äº¤è¨˜éŒ„
            </button>
            <button onclick="showSection('graded')" class="nav-btn bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                âœ… æ‰¹æ”¹å®Œæˆ
            </button>
            <button onclick="showSection('summary')" class="nav-btn bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                ğŸ“Š æœˆåº¦ç¸½çµ
            </button>
            <button onclick="showSection('manage')" class="nav-btn bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                ğŸ—‚ï¸ è¨˜éŒ„ç®¡ç†
            </button>
        </div>

        <!-- ç™¼ä½ˆåŠŸèª²å€åŸŸ -->
        <div id="homework-section" class="section bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                ğŸ“ ç™¼ä½ˆåŠŸèª²
            </h2>
            <form id="homework-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ—¥æœŸ</label>
                        <input type="date" id="homework-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ç§‘ç›®</label>
                        <select id="homework-subject" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">è«‹é¸æ“‡ç§‘ç›®</option>
                            <option value="ä¸­æ–‡">ä¸­æ–‡</option>
                            <option value="è‹±æ–‡">è‹±æ–‡</option>
                            <option value="æ•¸å­¸">æ•¸å­¸</option>
                            <option value="å¸¸è­˜">å¸¸è­˜</option>
                            <option value="äººæ–‡">äººæ–‡</option>
                            <option value="ç§‘å­¸">ç§‘å­¸</option>
                            <option value="é›»è…¦">é›»è…¦</option>
                            <option value="ç­å‹™">ç­å‹™</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">åŠŸèª²å…§å®¹</label>
                    <textarea id="homework-content" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="è«‹è¼¸å…¥åŠŸèª²å…§å®¹..."></textarea>
                </div>
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-colors">
                    ç™¼ä½ˆåŠŸèª²
                </button>
            </form>
        </div>

        <!-- æ¬ äº¤è¨˜éŒ„å€åŸŸ -->
        <div id="missing-section" class="section bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                âš ï¸ æ¬ äº¤è¨˜éŒ„
            </h2>
            <form id="missing-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ—¥æœŸ</label>
                        <input type="date" id="missing-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ç§‘ç›®</label>
                        <select id="missing-subject" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                            <option value="">è«‹é¸æ“‡ç§‘ç›®</option>
                            <option value="ä¸­æ–‡">ä¸­æ–‡</option>
                            <option value="è‹±æ–‡">è‹±æ–‡</option>
                            <option value="æ•¸å­¸">æ•¸å­¸</option>
                            <option value="å¸¸è­˜">å¸¸è­˜</option>
                            <option value="äººæ–‡">äººæ–‡</option>
                            <option value="ç§‘å­¸">ç§‘å­¸</option>
                            <option value="é›»è…¦">é›»è…¦</option>
                            <option value="ç­å‹™">ç­å‹™</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">å­¸ç”Ÿå§“å</label>
                        <input type="text" id="missing-student" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="è«‹è¼¸å…¥å­¸ç”Ÿå§“å">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ¬ äº¤åŠŸèª²</label>
                    <input type="text" id="missing-homework" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="è«‹è¼¸å…¥æ¬ äº¤çš„åŠŸèª²å…§å®¹">
                </div>
                <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-medium transition-colors">
                    è¨˜éŒ„æ¬ äº¤
                </button>
            </form>
        </div>

        <!-- æ‰¹æ”¹å®Œæˆå€åŸŸ -->
        <div id="graded-section" class="section bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                âœ… æ‰¹æ”¹å®Œæˆ
            </h2>
            <form id="graded-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ—¥æœŸ</label>
                        <input type="date" id="graded-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ç§‘ç›®</label>
                        <select id="graded-subject" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="">è«‹é¸æ“‡ç§‘ç›®</option>
                            <option value="ä¸­æ–‡">ä¸­æ–‡</option>
                            <option value="è‹±æ–‡">è‹±æ–‡</option>
                            <option value="æ•¸å­¸">æ•¸å­¸</option>
                            <option value="å¸¸è­˜">å¸¸è­˜</option>
                            <option value="äººæ–‡">äººæ–‡</option>
                            <option value="ç§‘å­¸">ç§‘å­¸</option>
                            <option value="é›»è…¦">é›»è…¦</option>
                            <option value="ç­å‹™">ç­å‹™</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ‰¹æ”¹æ•¸é‡</label>
                        <input type="number" id="graded-count" min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="è«‹è¼¸å…¥æ‰¹æ”¹æ•¸é‡">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">åŠŸèª²å…§å®¹</label>
                    <input type="text" id="graded-homework" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="è«‹è¼¸å…¥æ‰¹æ”¹çš„åŠŸèª²å…§å®¹">
                </div>
                <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-colors">
                    è¨˜éŒ„æ‰¹æ”¹
                </button>
            </form>
        </div>

        <!-- æœˆåº¦ç¸½çµå€åŸŸ -->
        <div id="summary-section" class="section bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                ğŸ“Š æœˆåº¦ç¸½çµ
            </h2>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">é¸æ“‡æœˆä»½</label>
                <input type="month" id="summary-month" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" onchange="updateSummary()">
            </div>
            <div id="summary-stats" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- çµ±è¨ˆå¡ç‰‡å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div class="flex gap-4">
                <button onclick="exportToExcel()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    ğŸ“Š åŒ¯å‡ºExcel
                </button>
            </div>
        </div>

        <!-- è¨˜éŒ„ç®¡ç†å€åŸŸ -->
        <div id="manage-section" class="section bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                ğŸ—‚ï¸ è¨˜éŒ„ç®¡ç†
            </h2>
            <div class="mb-6">
                <div class="flex flex-wrap gap-4 mb-4">
                    <select id="manage-type" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-transparent" onchange="loadManageRecords()">
                        <option value="homework">ç™¼ä½ˆåŠŸèª²</option>
                        <option value="missing">æ¬ äº¤è¨˜éŒ„</option>
                        <option value="graded">æ‰¹æ”¹å®Œæˆ</option>
                    </select>
                    <input type="month" id="manage-month" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-transparent" onchange="loadManageRecords()">
                </div>
            </div>
            <div id="manage-records" class="space-y-4">
                <!-- è¨˜éŒ„å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- ç·¨è¼¯æ¨¡æ…‹æ¡† -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ç·¨è¼¯è¨˜éŒ„</h3>
            <div id="edit-form-content">
                <!-- ç·¨è¼¯è¡¨å–®å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div class="flex gap-4 mt-6">
                <button onclick="saveEdit()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-medium transition-colors">
                    ä¿å­˜
                </button>
                <button onclick="closeEditModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg font-medium transition-colors">
                    å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ•¸æ“šå­˜å„²
        let homeworkData = JSON.parse(localStorage.getItem('homeworkData')) || [];
        let missingData = JSON.parse(localStorage.getItem('missingData')) || [];
        let gradedData = JSON.parse(localStorage.getItem('gradedData')) || [];
        let currentEditRecord = null;
        let currentEditType = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­ç½®é»˜èªæ—¥æœŸç‚ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('homework-date').value = today;
            document.getElementById('missing-date').value = today;
            document.getElementById('graded-date').value = today;
            
            // è¨­ç½®é»˜èªæœˆä»½ç‚ºç•¶å‰æœˆä»½
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('summary-month').value = currentMonth;
            document.getElementById('manage-month').value = currentMonth;
            
            updateSummary();
            loadManageRecords();
        });

        // é¡¯ç¤ºå€åŸŸ
        function showSection(section) {
            // éš±è—æ‰€æœ‰å€åŸŸ
            document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
            // é¡¯ç¤ºé¸ä¸­å€åŸŸ
            document.getElementById(section + '-section').classList.remove('hidden');
            
            // æ›´æ–°å°èˆªæŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-white');
            });
            event.target.classList.add('ring-2', 'ring-white');
        }

        // ç™¼ä½ˆåŠŸèª²
        document.getElementById('homework-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('homework-date').value;
            const subject = document.getElementById('homework-subject').value;
            const content = document.getElementById('homework-content').value;
            
            if (!date || !subject || !content) {
                alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼');
                return;
            }
            
            const record = {
                id: Date.now(),
                date: date,
                subject: subject,
                content: content,
                timestamp: new Date().toISOString()
            };
            
            homeworkData.push(record);
            localStorage.setItem('homeworkData', JSON.stringify(homeworkData));
            
            alert('åŠŸèª²ç™¼ä½ˆæˆåŠŸï¼');
            this.reset();
            document.getElementById('homework-date').value = new Date().toISOString().split('T')[0];
        });

        // è¨˜éŒ„æ¬ äº¤
        document.getElementById('missing-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('missing-date').value;
            const subject = document.getElementById('missing-subject').value;
            const student = document.getElementById('missing-student').value;
            const homework = document.getElementById('missing-homework').value;
            
            if (!date || !subject || !student || !homework) {
                alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼');
                return;
            }
            
            const record = {
                id: Date.now(),
                date: date,
                subject: subject,
                student: student,
                homework: homework,
                timestamp: new Date().toISOString()
            };
            
            missingData.push(record);
            localStorage.setItem('missingData', JSON.stringify(missingData));
            
            alert('æ¬ äº¤è¨˜éŒ„å·²ä¿å­˜ï¼');
            this.reset();
            document.getElementById('missing-date').value = new Date().toISOString().split('T')[0];
        });

        // è¨˜éŒ„æ‰¹æ”¹
        document.getElementById('graded-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('graded-date').value;
            const subject = document.getElementById('graded-subject').value;
            const count = document.getElementById('graded-count').value;
            const homework = document.getElementById('graded-homework').value;
            
            if (!date || !subject || !count || !homework) {
                alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼');
                return;
            }
            
            const record = {
                id: Date.now(),
                date: date,
                subject: subject,
                count: parseInt(count),
                homework: homework,
                timestamp: new Date().toISOString()
            };
            
            gradedData.push(record);
            localStorage.setItem('gradedData', JSON.stringify(gradedData));
            
            alert('æ‰¹æ”¹è¨˜éŒ„å·²ä¿å­˜ï¼');
            this.reset();
            document.getElementById('graded-date').value = new Date().toISOString().split('T')[0];
        });

        // æ›´æ–°æœˆåº¦ç¸½çµ
        function updateSummary() {
            const selectedMonth = document.getElementById('summary-month').value;
            if (!selectedMonth) return;
            
            const [year, month] = selectedMonth.split('-');
            
            // ç¯©é¸è©²æœˆä»½çš„æ•¸æ“š
            const monthHomework = homeworkData.filter(record => 
                record.date.startsWith(selectedMonth)
            );
            const monthMissing = missingData.filter(record => 
                record.date.startsWith(selectedMonth)
            );
            const monthGraded = gradedData.filter(record => 
                record.date.startsWith(selectedMonth)
            );
            
            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const totalHomework = monthHomework.length;
            const totalMissing = monthMissing.length;
            const totalGraded = monthGraded.reduce((sum, record) => sum + record.count, 0);
            
            // ç”Ÿæˆçµ±è¨ˆå¡ç‰‡
            const statsContainer = document.getElementById('summary-stats');
            statsContainer.innerHTML = `
                <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-500 cursor-pointer hover:bg-blue-100 transition-colors" onclick="showDetailRecords('homework', '${selectedMonth}')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">ç™¼ä½ˆåŠŸèª²</p>
                            <p class="text-3xl font-bold text-blue-800">${totalHomework}</p>
                        </div>
                        <div class="text-blue-500 text-2xl">ğŸ“</div>
                    </div>
                </div>
                <div class="bg-red-50 p-6 rounded-lg border-l-4 border-red-500 cursor-pointer hover:bg-red-100 transition-colors" onclick="showDetailRecords('missing', '${selectedMonth}')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">æ¬ äº¤è¨˜éŒ„</p>
                            <p class="text-3xl font-bold text-red-800">${totalMissing}</p>
                        </div>
                        <div class="text-red-500 text-2xl">âš ï¸</div>
                    </div>
                </div>
                <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-500 cursor-pointer hover:bg-green-100 transition-colors" onclick="showDetailRecords('graded', '${selectedMonth}')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">æ‰¹æ”¹å®Œæˆ</p>
                            <p class="text-3xl font-bold text-green-800">${totalGraded}</p>
                        </div>
                        <div class="text-green-500 text-2xl">âœ…</div>
                    </div>
                </div>
            `;
        }

        // é¡¯ç¤ºè©³ç´°è¨˜éŒ„
        function showDetailRecords(type, month) {
            document.getElementById('manage-type').value = type;
            document.getElementById('manage-month').value = month;
            loadManageRecords();
            showSection('manage');
        }

        // è¼‰å…¥ç®¡ç†è¨˜éŒ„
        function loadManageRecords() {
            const type = document.getElementById('manage-type').value;
            const month = document.getElementById('manage-month').value;
            
            let data = [];
            switch(type) {
                case 'homework':
                    data = homeworkData;
                    break;
                case 'missing':
                    data = missingData;
                    break;
                case 'graded':
                    data = gradedData;
                    break;
            }
            
            // ç¯©é¸è©²æœˆä»½çš„è¨˜éŒ„
            const filteredData = month ? 
                data.filter(record => record.date.startsWith(month)) : 
                data;
            
            const container = document.getElementById('manage-records');
            
            if (filteredData.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">æš«ç„¡è¨˜éŒ„</p>';
                return;
            }
            
            container.innerHTML = filteredData.map(record => {
                let content = '';
                switch(type) {
                    case 'homework':
                        content = `
                            <div class="flex-1">
                                <div class="font-medium text-gray-800">${record.subject} - ${record.date}</div>
                                <div class="text-gray-600 text-sm mt-1">${record.content}</div>
                            </div>
                        `;
                        break;
                    case 'missing':
                        content = `
                            <div class="flex-1">
                                <div class="font-medium text-gray-800">${record.subject} - ${record.date}</div>
                                <div class="text-gray-600 text-sm mt-1">å­¸ç”Ÿï¼š${record.student}</div>
                                <div class="text-gray-600 text-sm">æ¬ äº¤ï¼š${record.homework}</div>
                            </div>
                        `;
                        break;
                    case 'graded':
                        content = `
                            <div class="flex-1">
                                <div class="font-medium text-gray-800">${record.subject} - ${record.date}</div>
                                <div class="text-gray-600 text-sm mt-1">æ•¸é‡ï¼š${record.count} ä»½</div>
                                <div class="text-gray-600 text-sm">å…§å®¹ï¼š${record.homework}</div>
                            </div>
                        `;
                        break;
                }
                
                return `
                    <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between">
                        ${content}
                        <div class="flex gap-2">
                            <button onclick="editRecord('${type}', ${record.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                ç·¨è¼¯
                            </button>
                            <button onclick="deleteRecord('${type}', ${record.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                åˆªé™¤
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ç·¨è¼¯è¨˜éŒ„
        function editRecord(type, id) {
            let data = [];
            switch(type) {
                case 'homework':
                    data = homeworkData;
                    break;
                case 'missing':
                    data = missingData;
                    break;
                case 'graded':
                    data = gradedData;
                    break;
            }
            
            const record = data.find(r => r.id === id);
            if (!record) return;
            
            currentEditRecord = record;
            currentEditType = type;
            
            let formContent = '';
            switch(type) {
                case 'homework':
                    formContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ—¥æœŸ</label>
                                <input type="date" id="edit-date" value="${record.date}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ç§‘ç›®</label>
                                <select id="edit-subject" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <option value="ä¸­æ–‡" ${record.subject === 'ä¸­æ–‡' ? 'selected' : ''}>ä¸­æ–‡</option>
                                    <option value="è‹±æ–‡" ${record.subject === 'è‹±æ–‡' ? 'selected' : ''}>è‹±æ–‡</option>
                                    <option value="æ•¸å­¸" ${record.subject === 'æ•¸å­¸' ? 'selected' : ''}>æ•¸å­¸</option>
                                    <option value="å¸¸è­˜" ${record.subject === 'å¸¸è­˜' ? 'selected' : ''}>å¸¸è­˜</option>
                                    <option value="äººæ–‡" ${record.subject === 'äººæ–‡' ? 'selected' : ''}>äººæ–‡</option>
                                    <option value="ç§‘å­¸" ${record.subject === 'ç§‘å­¸' ? 'selected' : ''}>ç§‘å­¸</option>
                                    <option value="é›»è…¦" ${record.subject === 'é›»è…¦' ? 'selected' : ''}>é›»è…¦</option>
                                    <option value="ç­å‹™" ${record.subject === 'ç­å‹™' ? 'selected' : ''}>ç­å‹™</option>
                                    <option value="å…¶ä»–" ${record.subject === 'å…¶ä»–' ? 'selected' : ''}>å…¶ä»–</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">å…§å®¹</label>
                                <textarea id="edit-content" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg">${record.content}</textarea>
                            </div>
                        </div>
                    `;
                    break;
                case 'missing':
                    formContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ—¥æœŸ</label>
                                <input type="date" id="edit-date" value="${record.date}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ç§‘ç›®</label>
                                <select id="edit-subject" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <option value="ä¸­æ–‡" ${record.subject === 'ä¸­æ–‡' ? 'selected' : ''}>ä¸­æ–‡</option>
                                    <option value="è‹±æ–‡" ${record.subject === 'è‹±æ–‡' ? 'selected' : ''}>è‹±æ–‡</option>
                                    <option value="æ•¸å­¸" ${record.subject === 'æ•¸å­¸' ? 'selected' : ''}>æ•¸å­¸</option>
                                    <option value="å¸¸è­˜" ${record.subject === 'å¸¸è­˜' ? 'selected' : ''}>å¸¸è­˜</option>
                                    <option value="äººæ–‡" ${record.subject === 'äººæ–‡' ? 'selected' : ''}>äººæ–‡</option>
                                    <option value="ç§‘å­¸" ${record.subject === 'ç§‘å­¸' ? 'selected' : ''}>ç§‘å­¸</option>
                                    <option value="é›»è…¦" ${record.subject === 'é›»è…¦' ? 'selected' : ''}>é›»è…¦</option>
                                    <option value="ç­å‹™" ${record.subject === 'ç­å‹™' ? 'selected' : ''}>ç­å‹™</option>
                                    <option value="å…¶ä»–" ${record.subject === 'å…¶ä»–' ? 'selected' : ''}>å…¶ä»–</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">å­¸ç”Ÿå§“å</label>
                                <input type="text" id="edit-student" value="${record.student}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ¬ äº¤åŠŸèª²</label>
                                <input type="text" id="edit-homework" value="${record.homework}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                    `;
                    break;
                case 'graded':
                    formContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ—¥æœŸ</label>
                                <input type="date" id="edit-date" value="${record.date}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ç§‘ç›®</label>
                                <select id="edit-subject" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <option value="ä¸­æ–‡" ${record.subject === 'ä¸­æ–‡' ? 'selected' : ''}>ä¸­æ–‡</option>
                                    <option value="è‹±æ–‡" ${record.subject === 'è‹±æ–‡' ? 'selected' : ''}>è‹±æ–‡</option>
                                    <option value="æ•¸å­¸" ${record.subject === 'æ•¸å­¸' ? 'selected' : ''}>æ•¸å­¸</option>
                                    <option value="å¸¸è­˜" ${record.subject === 'å¸¸è­˜' ? 'selected' : ''}>å¸¸è­˜</option>
                                    <option value="äººæ–‡" ${record.subject === 'äººæ–‡' ? 'selected' : ''}>äººæ–‡</option>
                                    <option value="ç§‘å­¸" ${record.subject === 'ç§‘å­¸' ? 'selected' : ''}>ç§‘å­¸</option>
                                    <option value="é›»è…¦" ${record.subject === 'é›»è…¦' ? 'selected' : ''}>é›»è…¦</option>
                                    <option value="ç­å‹™" ${record.subject === 'ç­å‹™' ? 'selected' : ''}>ç­å‹™</option>
                                    <option value="å…¶ä»–" ${record.subject === 'å…¶ä»–' ? 'selected' : ''}>å…¶ä»–</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ‰¹æ”¹æ•¸é‡</label>
                                <input type="number" id="edit-count" value="${record.count}" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">åŠŸèª²å…§å®¹</label>
                                <input type="text" id="edit-homework" value="${record.homework}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                    `;
                    break;
            }
            
            document.getElementById('edit-form-content').innerHTML = formContent;
            document.getElementById('edit-modal').classList.remove('hidden');
            document.getElementById('edit-modal').classList.add('flex');
        }

        // ä¿å­˜ç·¨è¼¯
        function saveEdit() {
            if (!currentEditRecord || !currentEditType) return;
            
            const date = document.getElementById('edit-date').value;
            const subject = document.getElementById('edit-subject').value;
            
            if (!date || !subject) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼');
                return;
            }
            
            // æ›´æ–°è¨˜éŒ„
            switch(currentEditType) {
                case 'homework':
                    const content = document.getElementById('edit-content').value;
                    if (!content) {
                        alert('è«‹å¡«å¯«åŠŸèª²å…§å®¹ï¼');
                        return;
                    }
                    currentEditRecord.date = date;
                    currentEditRecord.subject = subject;
                    currentEditRecord.content = content;
                    localStorage.setItem('homeworkData', JSON.stringify(homeworkData));
                    break;
                case 'missing':
                    const student = document.getElementById('edit-student').value;
                    const homework = document.getElementById('edit-homework').value;
                    if (!student || !homework) {
                        alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼');
                        return;
                    }
                    currentEditRecord.date = date;
                    currentEditRecord.subject = subject;
                    currentEditRecord.student = student;
                    currentEditRecord.homework = homework;
                    localStorage.setItem('missingData', JSON.stringify(missingData));
                    break;
                case 'graded':
                    const count = document.getElementById('edit-count').value;
                    const gradedHomework = document.getElementById('edit-homework').value;
                    if (!count || !gradedHomework) {
                        alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼');
                        return;
                    }
                    currentEditRecord.date = date;
                    currentEditRecord.subject = subject;
                    currentEditRecord.count = parseInt(count);
                    currentEditRecord.homework = gradedHomework;
                    localStorage.setItem('gradedData', JSON.stringify(gradedData));
                    break;
            }
            
            closeEditModal();
            loadManageRecords();
            updateSummary();
            alert('è¨˜éŒ„å·²æ›´æ–°ï¼');
        }

        // é—œé–‰ç·¨è¼¯æ¨¡æ…‹æ¡†
        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            document.getElementById('edit-modal').classList.remove('flex');
            currentEditRecord = null;
            currentEditType = null;
        }

        // åˆªé™¤è¨˜éŒ„
        function deleteRecord(type, id) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿ')) return;
            
            switch(type) {
                case 'homework':
                    homeworkData = homeworkData.filter(record => record.id !== id);
                    localStorage.setItem('homeworkData', JSON.stringify(homeworkData));
                    break;
                case 'missing':
                    missingData = missingData.filter(record => record.id !== id);
                    localStorage.setItem('missingData', JSON.stringify(missingData));
                    break;
                case 'graded':
                    gradedData = gradedData.filter(record => record.id !== id);
                    localStorage.setItem('gradedData', JSON.stringify(gradedData));
                    break;
            }
            
            loadManageRecords();
            updateSummary();
            alert('è¨˜éŒ„å·²åˆªé™¤ï¼');
        }

        // åŒ¯å‡ºExcel
        function exportToExcel() {
            const selectedMonth = document.getElementById('summary-month').value;
            if (!selectedMonth) {
                alert('è«‹é¸æ“‡è¦åŒ¯å‡ºçš„æœˆä»½ï¼');
                return;
            }
            
            // ç¯©é¸è©²æœˆä»½çš„æ•¸æ“š
            const monthHomework = homeworkData.filter(record => 
                record.date.startsWith(selectedMonth)
            );
            const monthMissing = missingData.filter(record => 
                record.date.startsWith(selectedMonth)
            );
            const monthGraded = gradedData.filter(record => 
                record.date.startsWith(selectedMonth)
            );
            
            // å‰µå»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            
            // ç™¼ä½ˆåŠŸèª²å·¥ä½œè¡¨
            const homeworkWS = XLSX.utils.json_to_sheet(
                monthHomework.map(record => ({
                    'æ—¥æœŸ': record.date,
                    'ç§‘ç›®': record.subject,
                    'åŠŸèª²å…§å®¹': record.content
                }))
            );
            XLSX.utils.book_append_sheet(wb, homeworkWS, 'ç™¼ä½ˆåŠŸèª²');
            
            // æ¬ äº¤è¨˜éŒ„å·¥ä½œè¡¨
            const missingWS = XLSX.utils.json_to_sheet(
                monthMissing.map(record => ({
                    'æ—¥æœŸ': record.date,
                    'ç§‘ç›®': record.subject,
                    'å­¸ç”Ÿå§“å': record.student,
                    'æ¬ äº¤åŠŸèª²': record.homework
                }))
            );
            XLSX.utils.book_append_sheet(wb, missingWS, 'æ¬ äº¤è¨˜éŒ„');
            
            // æ‰¹æ”¹å®Œæˆå·¥ä½œè¡¨
            const gradedWS = XLSX.utils.json_to_sheet(
                monthGraded.map(record => ({
                    'æ—¥æœŸ': record.date,
                    'ç§‘ç›®': record.subject,
                    'æ‰¹æ”¹æ•¸é‡': record.count,
                    'åŠŸèª²å…§å®¹': record.homework
                }))
            );
            XLSX.utils.book_append_sheet(wb, gradedWS, 'æ‰¹æ”¹å®Œæˆ');
            
            // ä¸‹è¼‰æ–‡ä»¶
            const fileName = `åŠŸèª²ç®¡ç†è¨˜éŒ„_${selectedMonth}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        document.getElementById('edit-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9826ccac7644f4f8',t:'MTc1ODQyODczNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
